<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.5">Jekyll</generator><link href="https://whyjun.github.io/atom.xml" rel="self" type="application/atom+xml" /><link href="https://whyjun.github.io/" rel="alternate" type="text/html" /><updated>2024-07-08T19:41:30-05:00</updated><id>https://whyjun.github.io/atom.xml</id><title type="html">개발 기록</title><subtitle>개발자 경험(DX)을 생각하는 개발자입니다.</subtitle><author><name>Young Choi</name></author><entry xml:lang="en"><title type="html">Storing Heterogeneous Objects in PostgreSQL</title><link href="https://whyjun.github.io/blog/Storing-Heterogeneous-Objects-in-PostgreSQL" rel="alternate" type="text/html" title="Storing Heterogeneous Objects in PostgreSQL" /><published>2024-07-08T00:00:00-05:00</published><updated>2024-07-08T00:00:00-05:00</updated><id>https://whyjun.github.io/blog/Storing-Heterogeneous-Objects-in-PostgreSQL</id><content type="html" xml:base="https://whyjun.github.io/blog/Storing-Heterogeneous-Objects-in-PostgreSQL"><![CDATA[<p>Storing different types of objects in a PostgreSQL database can be tricky. But don’t worry, it’s manageable. Let’s explore three practical ways to handle this. We will keep it simple and straightforward.</p>

<h2 id="scenario-restaurant-order-system">Scenario: Restaurant Order System</h2>

<p>Imagine we have a Transaction table that stores different types of orders. Each order type has some common fields, but also unique fields.</p>

<h3 id="using-jsonb-for-orders">Using JSONB for Orders</h3>

<p>The JSONB data type is flexible. It allows you to store various order types without much hassle.</p>

<h4 id="schema">Schema</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">transactions</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">orders</span> <span class="n">JSONB</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="inserting-data">Inserting Data</h4>

<p>You can insert data by converting orders to JSON.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">transactions</span> <span class="p">(</span><span class="n">orders</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
    <span class="s1">'[
        {"type": "HamburgerOrder", "field1": "value1", "field2": "value2"},
        {"type": "PizzaOrder", "field1": "value1", "field2": "value2", "uniqueField": "uniqueValue"}
    ]'</span><span class="p">::</span><span class="n">jsonb</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="querying-data">Querying Data</h4>

<p>Retrieving specific orders is easy.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">transactions</span>
<span class="k">WHERE</span> <span class="n">orders</span> <span class="o">@&gt;</span> <span class="s1">'[{"type": "HamburgerOrder"}]'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="pros-and-cons">Pros and Cons</h4>

<p>Pros: Very flexible. Simple schema.
Cons: Complex queries. Limited data validation.</p>

<h3 id="using-a-normalized-schema">Using a Normalized Schema</h3>

<p>This method involves multiple tables and foreign keys. It keeps the database structure clean and efficient.</p>

<h4 id="schema-1">Schema</h4>

<p>Transactions Table:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">transactions</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Orders Table:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">transaction_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">transactions</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">common_field1</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">common_field2</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div></div>

<p>HamburgerOrder Table:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">hamburger_orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">orders</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">unique_hamburger_field</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div></div>

<p>PizzaOrder Table:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">pizza_orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">order_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">orders</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="n">unique_pizza_field</span> <span class="nb">TEXT</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="inserting-data-1">Inserting Data</h4>

<p>Insert data step-by-step.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">transactions</span> <span class="k">DEFAULT</span> <span class="k">VALUES</span> <span class="n">RETURNING</span> <span class="n">id</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">orders</span> <span class="p">(</span><span class="n">transaction_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">common_field1</span><span class="p">,</span> <span class="n">common_field2</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'HamburgerOrder'</span><span class="p">,</span> <span class="s1">'value1'</span><span class="p">,</span> <span class="s1">'value2'</span><span class="p">)</span> <span class="n">RETURNING</span> <span class="n">id</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">hamburger_orders</span> <span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">unique_hamburger_field</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'hamburgerValue'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="querying-data-1">Querying Data</h4>

<p>Use JOIN queries to get all orders.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">o</span><span class="p">.</span><span class="n">id</span> <span class="k">AS</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="k">type</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">common_field1</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">common_field2</span><span class="p">,</span>
       <span class="n">h</span><span class="p">.</span><span class="n">unique_hamburger_field</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">unique_pizza_field</span>
<span class="k">FROM</span> <span class="n">orders</span> <span class="n">o</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">hamburger_orders</span> <span class="n">h</span> <span class="k">ON</span> <span class="n">o</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">pizza_orders</span> <span class="n">p</span> <span class="k">ON</span> <span class="n">o</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">order_id</span>
<span class="k">WHERE</span> <span class="n">o</span><span class="p">.</span><span class="n">transaction_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="pros-and-cons-1">Pros and Cons</h4>
<p>Pros: Strong data integrity. Efficient querying.
Cons: More complex schema. Requires more tables.</p>

<h3 id="hybrid-approach-common-fields--jsonb">Hybrid Approach: Common Fields + JSONB</h3>

<p>This approach combines the best of both worlds. Common fields are stored directly in columns. Unique fields go into a JSONB column.</p>

<h4 id="schema-2">Schema</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">SERIAL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">transaction_id</span> <span class="nb">INT</span> <span class="k">REFERENCES</span> <span class="n">transactions</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">type</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">common_field1</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">common_field2</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">specific_fields</span> <span class="n">JSONB</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="inserting-data-2">Inserting Data</h4>

<p>Insert data with common fields and JSONB.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">orders</span> <span class="p">(</span><span class="n">transaction_id</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">common_field1</span><span class="p">,</span> <span class="n">common_field2</span><span class="p">,</span> <span class="n">specific_fields</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'HamburgerOrder'</span><span class="p">,</span> <span class="s1">'value1'</span><span class="p">,</span> <span class="s1">'value2'</span><span class="p">,</span> <span class="s1">'{"unique_hamburger_field": "hamburgerValue"}'</span><span class="p">::</span><span class="n">jsonb</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'PizzaOrder'</span><span class="p">,</span> <span class="s1">'value1'</span><span class="p">,</span> <span class="s1">'value2'</span><span class="p">,</span> <span class="s1">'{"unique_pizza_field": "pizzaValue"}'</span><span class="p">::</span><span class="n">jsonb</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="querying-data-2">Querying Data</h4>

<p>Query directly from the orders table.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">orders</span> <span class="k">WHERE</span> <span class="n">transaction_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="pros-and-cons-2">Pros and Cons</h4>

<p>Pros: Flexibility with JSONB. Easier querying for common fields.
Cons: Validation can be tricky. Slightly more complex.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Choosing the right method depends on your needs. JSONB is flexible but validation can be tricky. A normalized schema ensures data integrity but requires more tables. The hybrid approach offers a balanced solution. Each method has its pros and cons. Pick the one that fits your project best. Happy coding!</p>]]></content><author><name>Young Choi</name></author><category term="development" /><category term="java" /><category term="sql" /><summary type="html"><![CDATA[Storing different types of objects in a PostgreSQL database can be tricky. But don’t worry, it’s manageable. Let’s explore three practical ways to handle this. We will keep it simple and straightforward.]]></summary></entry><entry xml:lang="en"><title type="html">Using Interface for Controller Requests in Java Spring Framework</title><link href="https://whyjun.github.io/blog/Using-Interface-for-Controller-Requests-in-Java%20Spring-Framework" rel="alternate" type="text/html" title="Using Interface for Controller Requests in Java Spring Framework" /><published>2024-07-06T00:00:00-05:00</published><updated>2024-07-06T00:00:00-05:00</updated><id>https://whyjun.github.io/blog/Using-Interface-for-Controller-Request</id><content type="html" xml:base="https://whyjun.github.io/blog/Using-Interface-for-Controller-Requests-in-Java%20Spring-Framework"><![CDATA[<p>When building a REST API with Java Spring Framework, handling multiple types of requests efficiently can be challenging. One effective approach is to use interfaces for controller requests. In this blog post, we’ll walk through an example using a restaurant order system. We’ll handle different types of orders (like hamburger and pizza) with a single endpoint.</p>

<h2 id="scenario-restaurant-order-system">Scenario: Restaurant Order System</h2>

<p>Imagine we have an endpoint /v1/orders that accepts different types of orders. Each order type has some common fields, but also unique fields. We’ll use an interface called Order and implement it with specific classes for each order type. Let’s dive in.</p>

<h3 id="step-1-define-the-order-interface">Step 1: Define the Order Interface</h3>

<p>First, we create an Order interface with common fields that all orders will have.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getOrderType</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-2-implement-order-types">Step 2: Implement Order Types</h3>

<p>Next, we create classes for specific order types, like HamburgerOrder and PizzaOrder.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HamburgerOrder</span> <span class="kd">implements</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderType</span> <span class="o">=</span> <span class="s">"hamburger"</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">bunType</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">meatType</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">extraCheese</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PizzaOrder</span> <span class="kd">implements</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderType</span> <span class="o">=</span> <span class="s">"pizza"</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">crustType</span><span class="o">;</span>
    <span class="nd">@NotNull</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">extraToppings</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-3-create-the-controller">Step 3: Create the Controller</h3>

<p>Now, we create the controller to handle the /v1/orders POST request. We’ll use <code class="language-plaintext highlighter-rouge">@RequestBody</code> and <code class="language-plaintext highlighter-rouge">@Valid</code> annotations to ensure the request body is correctly validated.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.annotation.Validated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/v1/orders"</span><span class="o">)</span>
<span class="nd">@Validated</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="nd">@PostMapping</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">createOrder</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="nc">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">order</span> <span class="k">instanceof</span> <span class="nc">HamburgerOrder</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">HamburgerOrder</span> <span class="n">hamburgerOrder</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HamburgerOrder</span><span class="o">)</span> <span class="n">order</span><span class="o">;</span>
            <span class="c1">// Process hamburger order</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"Hamburger order received"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">order</span> <span class="k">instanceof</span> <span class="nc">PizzaOrder</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">PizzaOrder</span> <span class="n">pizzaOrder</span> <span class="o">=</span> <span class="o">(</span><span class="nc">PizzaOrder</span><span class="o">)</span> <span class="n">order</span><span class="o">;</span>
            <span class="c1">// Process pizza order</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"Pizza order received"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"Unknown order type"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-4-configure-jackson-for-polymorphic-deserialization">Step 4: Configure Jackson for Polymorphic Deserialization</h3>

<p>To handle polymorphic deserialization, we need to configure Jackson. This allows us to deserialize JSON into the correct Order implementation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonSubTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonTypeInfo</span><span class="o">;</span>

<span class="nd">@JsonTypeInfo</span><span class="o">(</span>
        <span class="n">use</span> <span class="o">=</span> <span class="nc">JsonTypeInfo</span><span class="o">.</span><span class="na">Id</span><span class="o">.</span><span class="na">NAME</span><span class="o">,</span>
        <span class="n">include</span> <span class="o">=</span> <span class="nc">JsonTypeInfo</span><span class="o">.</span><span class="na">As</span><span class="o">.</span><span class="na">PROPERTY</span><span class="o">,</span>
        <span class="n">property</span> <span class="o">=</span> <span class="s">"orderType"</span>
<span class="o">)</span>
<span class="nd">@JsonSubTypes</span><span class="o">({</span>
        <span class="nd">@JsonSubTypes</span><span class="o">.</span><span class="na">Type</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">HamburgerOrder</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"hamburger"</span><span class="o">),</span>
        <span class="nd">@JsonSubTypes</span><span class="o">.</span><span class="na">Type</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">PizzaOrder</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">"pizza"</span><span class="o">)</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getOrderType</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="step-5-add-global-validation-handling">Step 5: Add Global Validation Handling</h3>

<p>Finally, add global exception handling to manage validation errors.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.MethodArgumentNotValidException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="o">{</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">handleValidationExceptions</span><span class="o">(</span><span class="nc">MethodArgumentNotValidException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="s">"Invalid order data"</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">BAD_REQUEST</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Using interfaces for controller requests in Java Spring Framework allows you to handle multiple types of requests cleanly and efficiently. In this example, we created an Order interface and implemented specific order types, handled polymorphic deserialization with Jackson, and ensured validation with <code class="language-plaintext highlighter-rouge">@Valid</code> and <code class="language-plaintext highlighter-rouge">@RequestBody</code>. This approach makes your code more flexible and easier to maintain. Happy coding!</p>]]></content><author><name>Young Choi</name></author><category term="development" /><category term="java" /><summary type="html"><![CDATA[When building a REST API with Java Spring Framework, handling multiple types of requests efficiently can be challenging. One effective approach is to use interfaces for controller requests. In this blog post, we’ll walk through an example using a restaurant order system. We’ll handle different types of orders (like hamburger and pizza) with a single endpoint.]]></summary></entry><entry xml:lang="en"><title type="html">The Importance of Signals from Test Codes</title><link href="https://whyjun.github.io/blog/The-Importance-of-Signals-from-Test-Codes" rel="alternate" type="text/html" title="The Importance of Signals from Test Codes" /><published>2024-06-30T00:00:00-05:00</published><updated>2024-06-30T00:00:00-05:00</updated><id>https://whyjun.github.io/blog/The%20Importance-of-Signals-from-Test-Codes</id><content type="html" xml:base="https://whyjun.github.io/blog/The-Importance-of-Signals-from-Test-Codes"><![CDATA[<p>When you write test code, it can tell you a lot about your main code. If you find it hard to write tests, it often means there are problems in your code design. Let’s explore why these signals are important and what they can teach you.</p>

<h2 id="why-test-codes-matter">Why Test Codes Matter</h2>

<p>Test codes are like a mirror for your main code. They show you its strengths and weaknesses. Here are some key signals to watch for:</p>

<ul>
  <li>Difficulty Writing Tests: If you struggle to write tests, your code might be too complex or not modular.</li>
  <li>Excessive Mocking: If you need to mock too many things, your code might be tightly coupled.</li>
  <li>Long Setup Times: If setting up a test takes a long time, your code may have too many dependencies.</li>
  <li>Hidden Dependencies: If certain dependencies are not obvious, your code might be hard to maintain or extend.</li>
</ul>

<h2 id="key-signals-and-what-they-mean">Key Signals and What They Mean</h2>

<h3 id="excessive-mocking">Excessive Mocking</h3>

<ul>
  <li><strong>What It Is</strong>: Mocking means creating fake objects that mimic real ones.</li>
  <li><strong>The Signal</strong>: Needing too many mocks usually means your classes are too dependent on each other.</li>
  <li><strong>The Solution</strong>: Improve your code design. Break down large classes into smaller, independent ones.</li>
</ul>

<h3 id="long-setup-times">Long Setup Times</h3>

<ul>
  <li><strong>What It Is</strong>: Setting up tests should be quick and easy.</li>
  <li><strong>The Signal</strong>: Long setup times can mean your code has too many dependencies or lacks modularity.</li>
  <li><strong>The Solution</strong>: Simplify your code. Use dependency injection to reduce setup complexity.</li>
</ul>

<h3 id="difficulty-isolating-tests">Difficulty Isolating Tests</h3>

<ul>
  <li><strong>What It Is</strong>: Each test should run independently.</li>
  <li><strong>The Signal</strong>: If tests affect each other, your code might have hidden dependencies.</li>
  <li><strong>The Solution</strong>: Make your code more modular. Ensure each part of your code does one thing well.</li>
</ul>

<h3 id="hidden-dependencies">Hidden Dependencies</h3>

<ul>
  <li><strong>What It Is</strong>: Hidden dependencies are those that are not immediately obvious, such as using Instant.now directly within a method.</li>
  <li><strong>The Signal</strong>: If you find that certain parts of your code rely on hidden dependencies, it’s hard to write unit tests without mocks.</li>
  <li><strong>The Solution</strong>: Use dependency inversion. For example, instead of setting the current timestamp using Instant.now directly, inject a clock interface and use it to get the current time. This decouples your code from the specific implementation and makes it easier to test.</li>
</ul>

<h4 id="implementing-dependency-inversion">Implementing Dependency Inversion</h4>

<p>Here’s a practical example to illustrate how to handle hidden dependencies using dependency inversion:</p>

<p>Before:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Instant</span> <span class="n">timestamp</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Event</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Clock</span> <span class="o">{</span>
    <span class="nc">Instant</span> <span class="nf">now</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SystemClock</span> <span class="kd">implements</span> <span class="nc">Clock</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Instant</span> <span class="nf">now</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FakeClock</span> <span class="kd">implements</span> <span class="nc">Clock</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Instant</span> <span class="nf">now</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Instant</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"2007-12-03T10:15:30.00Z"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Instant</span> <span class="n">timestamp</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Event</span><span class="o">(</span><span class="nc">Clock</span> <span class="n">clock</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="n">clock</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="benefits-of-listening-to-these-signals">Benefits of Listening to These Signals</h2>

<p>By paying attention to these signals, you can improve your code design. This makes your code:</p>

<ul>
  <li>Easier to Understand: Clear, modular code is easier to read and maintain.</li>
  <li>More Reliable: Well-designed code has fewer bugs and is easier to test.</li>
  <li>More Flexible: Good design makes it easier to add new features.</li>
</ul>

<h2 id="practical-steps-to-improve-your-code">Practical Steps to Improve Your Code</h2>

<ul>
  <li>Refactor Regularly: Don’t wait until your code is a mess. Refactor as you go to keep your code clean.</li>
  <li>Use Dependency Injection: This reduces the need for mocks and makes your code more modular.</li>
  <li>Write Small, Focused Functions: Each function should do one thing and do it well. This makes them easier to test.</li>
  <li>Identify and Eliminate Hidden Dependencies: Use patterns like port-adapter and dependency inversion to decouple your code.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>Test codes are valuable tools. They don’t just check if your code works; they also show you where it needs improvement. By paying attention to the signals from your test codes, you can make your code more robust, easier to maintain, and more enjoyable to work with. Keep your tests simple, listen to what they’re telling you, and your code will thank you.</p>]]></content><author><name>Young Choi</name></author><category term="development" /><category term="test" /><summary type="html"><![CDATA[When you write test code, it can tell you a lot about your main code. If you find it hard to write tests, it often means there are problems in your code design. Let’s explore why these signals are important and what they can teach you.]]></summary></entry><entry xml:lang="ko"><title type="html">Go에서 omitempty 태그 사용하기</title><link href="https://whyjun.github.io/golang/Golang-Omitempty-Tag" rel="alternate" type="text/html" title="Go에서 omitempty 태그 사용하기" /><published>2023-03-15T00:00:00-05:00</published><updated>2023-03-15T00:00:00-05:00</updated><id>https://whyjun.github.io/golang/Golang-Omitempty-Tag</id><content type="html" xml:base="https://whyjun.github.io/golang/Golang-Omitempty-Tag"><![CDATA[<p>Go로 웹 서버를 개발하다 보면 JSON 데이터를 주고 받는 경우가 많이 있습니다. struct를 JSON으로 바꿀 때 값이 Zero Value(각 type별 기본 값)이거나 nil인 경우 그 값을 보내지 않아야할 때가 있습니다. 이런 경우, <code class="language-plaintext highlighter-rouge">omitempty</code> 태그를 활용하면 JSON에서 쉽게 생략할 수 있습니다.</p>

<p>struct 필드에 <code class="language-plaintext highlighter-rouge">omitempty</code> 태그가 있다면, Go 언어의 JSON 인코더는 그 필드의 값이 Zero Value거나 nil일 때 그 필드를 생략합니다. 이는 JSON으로 데이터를 보내고 받는 API를 개발할 때 유용하고 특히 JSON 메세지의 사이즈를 줄일 수 있다는 장점이 있습니다.</p>

<h2 id="omitempty-태그">omitempty 태그</h2>

<p>struct의 <code class="language-plaintext highlighter-rouge">omitempty</code> 태그는 아래와 같이 필드 type 뒤에 Backtick(`)안에 작성해 추가할 수 있습니다.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Person</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Name</span>      <span class="kt">string</span> <span class="s">`json:"name,omitempty"`</span>
    <span class="n">Age</span>       <span class="kt">int</span>    <span class="s">`json:"age,omitempty"`</span>
    <span class="n">Address</span>   <span class="kt">string</span> <span class="s">`json:"address,omitempty"`</span>
    <span class="n">Telephone</span> <span class="kt">string</span> <span class="s">`json:"telephone,omitempty"`</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위의 예시를 보면 모든 필드에 <code class="language-plaintext highlighter-rouge">omitempty</code> 태그가 있는 것을 볼 수 있습니다. 이는 필드의 값이 Zero Value라면 JSON 형식으로 데이터를 변경할 때 필드가 사라짐을 의미합니다. 예를 들어 아래의 값을 가진 <code class="language-plaintext highlighter-rouge">Person</code> 인스턴스가 있다고 합시다.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">:=</span> <span class="n">Person</span><span class="p">{</span>
    <span class="n">Name</span><span class="o">:</span>      <span class="s">"John"</span><span class="p">,</span>
    <span class="n">Age</span><span class="o">:</span>       <span class="m">0</span><span class="p">,</span>
    <span class="n">Address</span><span class="o">:</span>   <span class="s">""</span><span class="p">,</span>
    <span class="n">Telephone</span><span class="o">:</span> <span class="s">"123-456-7890"</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Person</code>을 <code class="language-plaintext highlighter-rouge">json.Marshal</code> 함수를 사용해서 JSON으로 바꾼다면 결과값은 아래와 같이 나옵니다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"telephone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123-456-7890"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>위에서 볼 수 있듯이, <code class="language-plaintext highlighter-rouge">Age</code>와 <code class="language-plaintext highlighter-rouge">Address</code> 필드가 사라진 것을 확인할 수 있습니다.</p>]]></content><author><name>Young Choi</name></author><category term="Golang" /><category term="golang" /><summary type="html"><![CDATA[Go로 웹 서버를 개발하다 보면 JSON 데이터를 주고 받는 경우가 많이 있습니다. struct를 JSON으로 바꿀 때 값이 Zero Value(각 type별 기본 값)이거나 nil인 경우 그 값을 보내지 않아야할 때가 있습니다. 이런 경우, omitempty 태그를 활용하면 JSON에서 쉽게 생략할 수 있습니다.]]></summary></entry><entry xml:lang="ko"><title type="html">golangcli-lint로 Go 코드 규칙 적용하기</title><link href="https://whyjun.github.io/golang/Use-GolangCI-Lint" rel="alternate" type="text/html" title="golangcli-lint로 Go 코드 규칙 적용하기" /><published>2023-03-08T00:00:00-06:00</published><updated>2023-03-08T00:00:00-06:00</updated><id>https://whyjun.github.io/golang/Use-GolangCI-Lint</id><content type="html" xml:base="https://whyjun.github.io/golang/Use-GolangCI-Lint"><![CDATA[<p>개발팀 사이즈가 커지면서 관리해야 하는 리포지토리의 개수가 늘어났고 각각의 프로젝트가 팀을 리드하는 개발자에 따라 자유분방한 모습으로 진화했습니다. 특히 Go 언어를 처음으로 사용하는 개발자들이 늘어나면서 코드 리뷰 과정에서 Idiomatic Go에 대해서 설명하고 작성하는데 시간을 꽤 소모하게 되었습니다. 그러다보니 실제로 리뷰가 되어야 하는 부분보다 더 많은 시간을 쏟게 되는 경우가 늘어났고 이를 방지하기 위해 자동화된 도구가 필요하다라는 피드백이 나오기 시작했습니다.</p>

<p>다행히도 Go 커뮤니티에는 다양한 Lint 도구들이 이미 개발되어 있었는데 대표적으로 <code class="language-plaintext highlighter-rouge">govet</code>, <code class="language-plaintext highlighter-rouge">gofmt</code>, <code class="language-plaintext highlighter-rouge">golint</code> 등이 있습니다. 이러한 도구들은 좋은 Go 코드를 작성하기 위해 필요한 부분들을 다 체크하지만 각각 따로 돌려야 한다는 단점이 있습니다. 이러한 단점을 극복하기 위해 저희 팀은 <code class="language-plaintext highlighter-rouge">golangci-lint</code>를 사용하기로 했습니다.</p>

<p><code class="language-plaintext highlighter-rouge">golangci-lint</code>는 Lint 도구는 아니지만 다양한 Lint 도구들을 한번에 돌릴 수 있게 도와줍니다. 단순히 도구들을 순서대로 돌리는 것이 아니라 병렬적으로 돌리는 동시에 분석 결과값을 캐싱함으로써 정적 분석을 매우 빠르게 끝낼 수 있습니다. 그리고 회사에 많은 개발자들이 사용하고 있는 Visual Studio Code를 지원하고 이 점을 활용해 <code class="language-plaintext highlighter-rouge">settings.json</code>에 설정 몇 가지를 추가하는 것으로 코드 규칙을 지키지 않을 경우 Warning 메세지를 바로 띄워주어 개발자들이 빠르게 고칠 수 있게 도와줍니다.</p>

<p><img src="https://repository-images.githubusercontent.com/132145189/05239680-dfaf-11e9-9646-2c3ef2f5f8d4" alt="golangci-lint log" class="align-center" /></p>

<h2 id="설치하기">설치하기</h2>

<p>Mac과 Windows가 아닌 다른 환경에서 설치하는 방법은 <a href="https://golangci-lint.run/usage/install/">공식 문서</a>에 자세히 나와있습니다.</p>

<h3 id="mac">Mac</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>golangci-lint
brew upgrade golangci-lint

golangci-lint version
</code></pre></div></div>

<h3 id="windows">Windows</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Git for Windows를 설치할 때 같이 설치되는 Git Bash에 아래 명령어를 입력하시면 설치됩니다.</span>
<span class="c"># 실제 binary는 $(go env GOPATH)/bin/golangci-lint에 있습니다</span>
curl <span class="nt">-sSfL</span> https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh <span class="nt">-s</span> <span class="nt">--</span> <span class="nt">-b</span> <span class="si">$(</span>go <span class="nb">env </span>GOPATH<span class="si">)</span>/bin 

golangci-lint <span class="nt">--version</span>
</code></pre></div></div>

<h2 id="사용하기">사용하기</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>golangci-lint run
</code></pre></div></div>

<p>위 명령어를 입력하면 <code class="language-plaintext highlighter-rouge">golangci-lint</code> 기본으로 설정되어 있는 Lint 도구들로 코드를 분석합니다. 어떠한 도구들을 사용하는지 확인하고 싶으면 <code class="language-plaintext highlighter-rouge">golangci-lint help linters</code>로 확인할 수 있습니다. <code class="language-plaintext highlighter-rouge">golangci-lint</code>를 직접 설정하고 싶다면 <a href="https://golangci-lint.run/usage/configuration/">공식 문서</a>를 참고해서 <code class="language-plaintext highlighter-rouge">.golangci.yml</code> 파일을 작성하시면 됩니다.</p>

<h2 id="visual-studio-code에-추가하기">Visual Studio Code에 추가하기</h2>

<p>Visual Studio Code 설정에 들어가서 <code class="language-plaintext highlighter-rouge">settings.json</code>을 연 다음, 아래 설정을 추가하면 Visual Studio Code에서 Warning 메세지를 확인할 수 있습니다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"go.lintTool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"golangci-lint"</span><span class="w">
</span><span class="nl">"go.lintFlags"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"--fast"</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="사용-후기">사용 후기</h2>

<p>실제로 적용해보니 코드 리뷰로 잡아내지 못한 이슈들이 꽤 있었습니다. 대표적으로 error를 <code class="language-plaintext highlighter-rouge">fmt.Errorf</code>로 래핑할 때, <code class="language-plaintext highlighter-rouge">%w</code>를 사용하지 않았던 부분입니다. <code class="language-plaintext highlighter-rouge">errors</code> 패키지를 잘 활용하지 않았다보니 알아차리지 못했지만 프로젝트의 사이즈가 커지면서 어떤 error인지를 확인해야 하는 경우가 빈번하게 발생했는데 <code class="language-plaintext highlighter-rouge">%w</code>가 아닌 <code class="language-plaintext highlighter-rouge">%s</code>나 <code class="language-plaintext highlighter-rouge">%v</code>를 사용했을 때는 <code class="language-plaintext highlighter-rouge">errors.UnWrap()</code> 함수를 사용할 수 없고 그 때문에 <code class="language-plaintext highlighter-rouge">errors.Is</code>와 <code class="language-plaintext highlighter-rouge">errors.As</code>도 활용할 수 없다는 것을 알게 되었습니다. 이처럼 Linter는 하나의 정해진 코드 규칙을 모든 개발자가 지킬 수 있게 해준다는 점을 넘어서 코드에 있는 버그들을 개발자들이 일찍 알아차릴 수 있게 해줍니다.</p>]]></content><author><name>Young Choi</name></author><category term="Golang" /><category term="golang" /><summary type="html"><![CDATA[개발팀 사이즈가 커지면서 관리해야 하는 리포지토리의 개수가 늘어났고 각각의 프로젝트가 팀을 리드하는 개발자에 따라 자유분방한 모습으로 진화했습니다. 특히 Go 언어를 처음으로 사용하는 개발자들이 늘어나면서 코드 리뷰 과정에서 Idiomatic Go에 대해서 설명하고 작성하는데 시간을 꽤 소모하게 되었습니다. 그러다보니 실제로 리뷰가 되어야 하는 부분보다 더 많은 시간을 쏟게 되는 경우가 늘어났고 이를 방지하기 위해 자동화된 도구가 필요하다라는 피드백이 나오기 시작했습니다.]]></summary></entry><entry xml:lang="ko"><title type="html">Go에서 Enum 사용하기 그리고 주의할 점</title><link href="https://whyjun.github.io/golang/Enum-in-Golang" rel="alternate" type="text/html" title="Go에서 Enum 사용하기 그리고 주의할 점" /><published>2022-01-09T00:00:00-06:00</published><updated>2022-01-09T00:00:00-06:00</updated><id>https://whyjun.github.io/golang/Enum-in-Golang</id><content type="html" xml:base="https://whyjun.github.io/golang/Enum-in-Golang"><![CDATA[<p>Go 언어는 <code class="language-plaintext highlighter-rouge">enum</code> 타입을 제공하지 않지만 <code class="language-plaintext highlighter-rouge">Enum</code>으로 사용할 데이터 타입을 따로 생성 후 <code class="language-plaintext highlighter-rouge">iota</code>를 이용해서 비슷하게 사용할 수 있다. <a href="https://go.dev/play/p/5C0w6YGPyys">(예시 코드)</a></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"fmt"</span>

<span class="k">type</span> <span class="n">level</span> <span class="kt">int</span>
<span class="k">type</span> <span class="n">Status</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
	<span class="n">easy</span> <span class="n">level</span> <span class="o">=</span> <span class="no">iota</span> <span class="o">+</span> <span class="m">1</span>
	<span class="n">medium</span>
	<span class="n">hard</span>
<span class="p">)</span>

<span class="k">const</span> <span class="p">(</span>
	<span class="n">StatusUnknown</span> <span class="n">Status</span> <span class="o">=</span> <span class="no">iota</span>
	<span class="n">StatusOK</span>
	<span class="n">StatusError</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">levelList</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">level</span><span class="p">{</span><span class="n">easy</span><span class="p">,</span> <span class="n">medium</span><span class="p">,</span> <span class="n">hard</span><span class="p">}</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">levelList</span><span class="p">)</span>
	<span class="c">// Output: [1 2 3]</span>

	<span class="n">statusList</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">Status</span><span class="p">{</span><span class="n">StatusUnknown</span><span class="p">,</span> <span class="n">StatusOK</span><span class="p">,</span> <span class="n">StatusError</span><span class="p">}</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">statusList</span><span class="p">)</span>
	<span class="c">// Output: [0 1 2]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>주의할 점은 <code class="language-plaintext highlighter-rouge">iota</code>가 항상 0 부터 시작하기 때문에 <code class="language-plaintext highlighter-rouge">enum</code>의 첫 값을 <code class="language-plaintext highlighter-rouge">iota + 1</code>으로 해서 1 부터 시작하도록 하던지 아니면 첫 <code class="language-plaintext highlighter-rouge">enum</code>을 Unknown이나 Nil을 나타내는데 사용해야 한다. Go의 <code class="language-plaintext highlighter-rouge">Zero Value</code>때문에 예상치 못한 부작용이 생길 수 있기 때문이다.</p>

<p>이벤트 큐에서 아래와 같은 <code class="language-plaintext highlighter-rouge">JSON</code> 형식의 request를 받는 시스템이 있다고 가정해보자.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Request</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">ID</span>        <span class="kt">int</span>    <span class="s">`json:"ID"`</span>
	<span class="n">Timestamp</span> <span class="kt">int</span>    <span class="s">`json:"Timestamp"`</span>
	<span class="n">Message</span>   <span class="kt">string</span> <span class="s">`json:"Message"`</span>
	<span class="n">Status</span>    <span class="n">Status</span> <span class="s">`json:"Status"`</span>
<span class="p">}</span>
</code></pre></div></div>

<p>만약 이 Request를 보내는 코드에서 아래와 같이 <code class="language-plaintext highlighter-rouge">Status</code>를 <code class="language-plaintext highlighter-rouge">JSON</code>에 넣는 것을 까먹고 보냈다면 어떻게 될까?</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ID"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1641775651</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example message"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Status</code> 필드에 아무런 데이터가 들어가있지 않기 때문에 Request의 Status 값은 <code class="language-plaintext highlighter-rouge">int</code>의 <code class="language-plaintext highlighter-rouge">Zero Value</code>인 0이 될 것이다. 첫 <code class="language-plaintext highlighter-rouge">enum</code>이 <code class="language-plaintext highlighter-rouge">StatusUnknown</code>이 아니라 <code class="language-plaintext highlighter-rouge">StatusOK</code>였다면 <code class="language-plaintext highlighter-rouge">Status</code> 데이터가 없는 모든 Request들은 아무도 모르게 버그를 일으킬 것이다. 그렇기 때문에 Go에서 <code class="language-plaintext highlighter-rouge">enum</code>을 사용할 때는 <code class="language-plaintext highlighter-rouge">Zero Value</code>를 염두에 두고 꼭 첫 <code class="language-plaintext highlighter-rouge">enum</code>을 Unknown이나 Nil을 나타내는 값으로 지정하는 습관을 가져야 한다.</p>]]></content><author><name>Young Choi</name></author><category term="Golang" /><category term="golang" /><summary type="html"><![CDATA[Go 언어는 enum 타입을 제공하지 않지만 Enum으로 사용할 데이터 타입을 따로 생성 후 iota를 이용해서 비슷하게 사용할 수 있다. (예시 코드)]]></summary></entry><entry xml:lang="ko"><title type="html">Go에서 HashSet 구현하기</title><link href="https://whyjun.github.io/golang/Write-Hashset-in-Go" rel="alternate" type="text/html" title="Go에서 HashSet 구현하기" /><published>2021-12-18T00:00:00-06:00</published><updated>2021-12-18T00:00:00-06:00</updated><id>https://whyjun.github.io/golang/Write-HashSet-In-Go</id><content type="html" xml:base="https://whyjun.github.io/golang/Write-Hashset-in-Go"><![CDATA[<p>12월 18일 기준 가장 최근 버전인 Go 1.17에도 아직 <code class="language-plaintext highlighter-rouge">Set</code>이라는 자료구조가 없다. 알고리즘 문제나 Advent of Code 문제를 풀 때 <code class="language-plaintext highlighter-rouge">Set</code>을 필요로 하는 경우가 생각보다 많았어서 직접 구현해보았다.</p>

<p><code class="language-plaintext highlighter-rouge">Set</code>이라는 자료구조를 통해 얻고 싶어하는 기능들을 아래와 같다.</p>

<ul>
  <li>데이터를 <strong>중복 없이</strong> 관리하고 싶을 때</li>
  <li>데이터를 쉽게 추가하고 제거하는 기능이 필요할 때</li>
  <li>데이터를 적은 공간 복잡도를 가진 자료구조에서 관리하고 싶을 때</li>
</ul>

<p>그리고 이러한 기능들은 Go 언어에서 제공하는 <code class="language-plaintext highlighter-rouge">map</code>을 사용하면 아래와 같이 간단하게 구현할 수 있다.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">set</span> <span class="k">map</span><span class="p">[</span><span class="k">interface</span><span class="p">{}]</span><span class="k">struct</span><span class="p">{}</span>
</code></pre></div></div>

<p>실제로 사용할 때는 <code class="language-plaintext highlighter-rouge">interface{}</code>를 추가하고 싶은 데이터의 자료형으로 변경해서 사용하면 된다. (e.g: <code class="language-plaintext highlighter-rouge">type set map[string]struct{}</code>) Go에서 <code class="language-plaintext highlighter-rouge">map</code>은 <code class="language-plaintext highlighter-rouge">HashTable</code>을 구현해놓은 것이기 때문에 key는 중복될 수 없고 데이터를 추가하고 제거하는 것은 O(1)으로 매우 빠르다. 그리고 빈 <code class="language-plaintext highlighter-rouge">struct{}</code>는 0바이트이기 때문에 메모리 사용도 최소화할 수 있다.</p>

<p>만약 위의 타입을 그냥 사용하는 것이 다른 동료 개발자들을 헷갈리게 할 것 같다면 아래와 같이 <code class="language-plaintext highlighter-rouge">set</code>에 함수들을 추가하는 것으로 해결할 수 있다.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">set</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">v</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="n">s</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="k">struct</span><span class="p">{}{}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">set</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">v</span> <span class="k">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nb">delete</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">set</span><span class="p">)</span> <span class="n">Contain</span><span class="p">(</span><span class="n">v</span> <span class="k">interface</span><span class="p">{})</span> <span class="kt">bool</span> <span class="p">{</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">s</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">ok</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">set</span><span class="p">)</span> <span class="n">Length</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>위의 코드들은 <a href="https://go.dev/play/p/XthHr8HUHHL">Go Playground</a>에서 직접 사용해보실 수 있다.</p>]]></content><author><name>Young Choi</name></author><category term="Golang" /><category term="golang" /><category term="data structure" /><summary type="html"><![CDATA[12월 18일 기준 가장 최근 버전인 Go 1.17에도 아직 Set이라는 자료구조가 없다. 알고리즘 문제나 Advent of Code 문제를 풀 때 Set을 필요로 하는 경우가 생각보다 많았어서 직접 구현해보았다.]]></summary></entry></feed>